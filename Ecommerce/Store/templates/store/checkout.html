<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shopping Cart</title>
  <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  <style>
    /* Full-page layout and centering */

    :root {
      --primary: #275EFE;
      --primary-light: #7699FF;
      --dark: #1C212E;
      --grey-dark: #3F4656;
      --grey: #6C7486;
      --grey-light: #CDD9ED;
      --white: #FFF;
      --green: #16BF78;
      --sand: #DCB773;
      --sand-light: #EDD9A9;
    }

    * {
      box-sizing: inherit;
    }

    body, html {
      height: 100%;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
      display: flex;
    }


    /* Master container now stacks vertically */
    .master-container {
      display: flex;
      flex-direction: column; /* Stack cards vertically */
      gap: 10px;
      width: 80%;
      max-width: 100%; /* Adjusted for vertical layout */
      height: 80%;
      padding: 20px;
      justify-content: center;
    }

    /* Card styles */
    .card {
      background: #FFFFFF;
      box-shadow: 0px 187px 75px rgba(0, 0, 0, 0.01), 0px 105px 63px rgba(0, 0, 0, 0.05), 0px 47px 47px rgba(0, 0, 0, 0.09), 0px 12px 26px rgba(0, 0, 0, 0.1), 0px 0px 0px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .card__counter-score,
    .card__btn {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .title {
      width: 100%;
      height: 40px;
      position: relative;
      display: flex;
      align-items: center;
      padding-left: 20px;
      border-bottom: 1px solid #efeff3;
      font-weight: 700;
      font-size: 14px;
      color: #63656b;
    }

    .products {
      display: flex;
      flex-direction: column;
      padding: 10px;
    }

    .product {
      display: grid;
      grid-template-columns: 60px 1fr 80px 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }

    .product span {
      font-size: 13px;
      font-weight: 600;
      color: #47484b;
    }

    .product p {
      font-size: 11px;
      font-weight: 600;
      color: #7a7c81;
    }

    .product img {
        width: 100%; /* Ensures the image fills the container */
        max-width: 100px; /* Set a maximum size */
        aspect-ratio: 3/4; /* Maintain the 16:9 ratio */
        object-fit: cover; /* Ensures the image scales properly without distortion */
        border-radius: 5px; /* Optional for rounded corners */
      }

    .quantity {
      height: 30px;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      margin: auto;
      background-color: #ffffff;
      border: 1px solid #e5e5e5;
      border-radius: 7px;
      filter: drop-shadow(0px 1px 0px #efefef)
        drop-shadow(0px 1px 0.5px rgba(239, 239, 239, 0.5));
    }

    .quantity label {
      width: 20px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding-bottom: 2px;
      font-size: 15px;
      font-weight: 700;
      color: #47484b;
    }

    .quantity button {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 0;
      outline: none;
      background-color: transparent;
    }

    .price {
      font-size: 15px;
      font-weight: 600;
      color: #47484b;
      margin-top: 10px;
    }

    /* Checkout section styles */
    .checkout {
      display: flex;
      flex-direction: column;
      border-radius: 9px 9px 19px 19px;
      background: #FFFFFF;
      padding: 20px;
      justify-content: center;
    }

    .details {
      display: grid;
      grid-template-columns: 3fr 1fr;
      padding: 10px;
      gap: 5px;
    }

    .details span {
      font-size: 13px;
      font-weight: 600;
      text-align: left;
    }

    .details span:nth-child(2),
    .details span:nth-child(4) {
    text-align: right;
    }

    .checkout--footer {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      background-color: #efeff3;
      margin-bottom: 10px;
    }

    .price {
      font-size: 22px;
      color: #2B2B2F;
      font-weight: 900;
    }

    .price sup {
      font-size: 13px;
    }

    .price sub {
      font-size: 11px;
      color: #5F5D6B;
    }


    

    

  </style>
</head>
<body>
  <div class="master-container">
    <div class="card cart">
      <label class="title">Your Cart</label>
      <div class="products">
        {% for item in cart.items.all %}
        <div class="product align-items-center" >
          <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" style="width: 60px; height: 60px;"/>
          <span>{{ item.product.name }}</span>
          <div class="quantity">
            <button class="card__btn remove_from_cart" data-product-id="{{ item.product.id }}" {% if product.quantity_in_cart == 0 %}disabled{% endif %}> - </button>
            <div class="card__counter-score" data-product-id="{{ item.product.id }}">{{ item.quantity }}</div>
            <button class="card__btn add_to_cart" data-product-id="{{ item.product.id }}">+</button>
          </div>
          <label class="price small">₹{{ item.product.price }}</label>
        </div>
        {% endfor %}
      </div>
    </div>

    <div class="card checkout">
      <label class="title">Checkout</label>
      <div class="details">
        <span>Your cart subtotal:</span>
        <span id="total-price">₹{{ total_price }}</span>
        <span>Shipping fees:</span>
        <span id="shipping-fees">₹{{ shipping }}</span>
      </div>
      <div class="checkout--footer">
        <label class="price align-content-center" id="grand-total"> <span>Total: ₹</span> {{ total }} </label>
      </div>
    </div>
  </div>
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    
    

      // Add to cart functionality (+ button)
      $(document).on("click", ".add_to_cart", function () {
          const productId = $(this).data("product-id");
          const addToCartUrl = "/add_to_cart/" + productId + "/";
  
          $.ajax({
              url: addToCartUrl,
              method: "GET",
              success: function (response) { 
                  // Update the product quantity on the card
                  const quantityDiv = $(`.card__counter-score[data-product-id="${productId}"]`);
                    quantityDiv.text(response.updated_quantity); // Update the displayed quantity

                  $("#total-price").text('₹ '+response.total_price); // Update the total price
                  $("#shipping-fees").text('₹ '+response.shipping); // Update shipping fees
                  $("#grand-total").text('Total: ₹ '+response.total); // Update grand total
              },
              error: function (xhr, status, error) {
                  alert("An error occurred. Please try again.");
              },
          });
      });
  
      // Remove from cart functionality (- button)
      $(document).on("click", ".remove_from_cart", function () {
          const productId = $(this).data("product-id");
          const removeFromCartUrl = "/remove_from_cart/" + productId + "/";
  
          $.ajax({
              url: removeFromCartUrl,
              method: "GET",
              success: function (response) {
                  // Update the product quantity on the card
                  const quantityDiv = $(`.card__counter-score[data-product-id="${productId}"]`);
                    quantityDiv.text(response.updated_quantity);
                    $("#total-price").text('₹'+response.total_price); // Update the total price
                  $("#shipping-fees").text('₹'+response.shipping); // Update shipping fees
                  $("#grand-total").text('Total: ₹ '+response.total); // Update grand total
              },
              error: function (xhr, status, error) {
                  alert("An error occurred. Please try again.");
              },
          });
      });
  </script>
</body>
</html>
